<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACUERDOS DIARIOS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/">Home</a>
                    </li>
                </ul>
                <span class="navbar-text">
                    <input type="file" id="fileInput">

                    <button style="background-color: #007bff;" class="btn text-white btn-lg" id="processButton">¿Quienes
                        tienen acuerdos?</button>
                </span>
            </div>
        </div>
    </nav>

    <div id="responseMessage"></div> <!-- Contenedor donde se mostrará el mensaje -->

    <div class="container d-flex justify-content-center align-items-center" style="height: 100vh;">
        <div class="text-center">
            <h4 class="mb-4">ACUERDOS DIARIOS POR ENTIDAD</h4>
            <div class="d-grid gap-2">
                <button style="background-color: #d6190f;" class="btn text-white btn-lg"
                    onclick="navigateTo('./acuerdos/clearing')">Clearing</button>
                <button style="background-color: #360fd6;" class="btn text-white btn-lg"
                    onclick="navigateTo('./acuerdos/acac')">Acac</button>
                <button style="background-color: #f0a500;" class="btn text-white btn-lg"
                    onclick="navigateTo('/acuerdos/credicompras')">Credicompras</button>
                <button style="background-color: #28a745;" class="btn text-white btn-lg"
                    onclick="navigateTo('./acuerdos/fucerep')">Capta fucerep Tardia</button>
                <button style="background-color: #ecc412;" class="btn text-white btn-lg"
                    onclick="navigateTo('./acuerdos/creditos-directos')">Creditos directos Capta</button>
                <button style="background-color: #cc31b5;" class="btn text-white btn-lg"
                    onclick="navigateTo('./acuerdos/viem-capta')">Viem Capta</button>
                <button style="background-color: #8114e1;" class="btn text-white btn-lg"
                    onclick="navigateTo('./acuerdos/viem-maga')">Viem Maga</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script>


function navigateTo(entity) {
      const url = `${entity}.html`;
      window.location.href = url;
    }
        function processCSV() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert('Por favor, selecciona un archivo CSV.');
                return;
            }

            Papa.parse(file, {
                header: true, // Convierte la primera fila en nombres de columna
                skipEmptyLines: true,
                complete: function (results) {
                    const data = results.data;

                    // Definir entidades a buscar
                    const entidades = ["VIEMVENTURA", "CREDICOMPRAS", "CAPTA VIEMVENTURA", "CREDITOS DIRECTOS CAPTA", "CAPTA FUCEREP TARDIA", "ACAC", "CLEARING"];
                    const entidadesConAcuerdos = [];

                    // Iterar sobre las entidades y verificar si tienen acuerdos
                    entidades.forEach(entidad => {
                        // Verificar si existe al menos un "Acuerdo libre" para esa entidad
                        const acuerdo = data.some(row =>
                            row["Entidad"] === entidad && row["resultados"] === "Acuerdo libre"
                        );

                        if (acuerdo) {
                            entidadesConAcuerdos.push(entidad);
                        }
                    });

                    // Mostrar el resultado
                    const responseMessage = document.getElementById('responseMessage');
                    if (entidadesConAcuerdos.length > 0) {
                        responseMessage.innerHTML = "<div class='alert alert-warning text-center'>Hay acuerdos generados para: " + entidadesConAcuerdos.map((ent) => `<p>✅  ${ent}</p>`).join('') + "<br></div>";
                    } else {
                        responseMessage.innerHTML = "<div class='alert alert-danger text-center'>❌ No se encontraron acuerdos.</div>";
                    }
                },
                error: function (error) {
                    alert("Error al procesar el archivo: " + error.message);
                }
            });
        }

        document.getElementById("processButton").addEventListener("click", processCSV);
    </script>


</body>

</html>